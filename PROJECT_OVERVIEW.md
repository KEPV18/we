# ููุฎุต ูููู ูุดุฑูุน WE Usage Bot

- ุงููุฏู: ุจูุช ุชูููุฌุฑุงู ูุนุฑุถ ุญุงูุฉ ุจุงูุฉ WE Home Internetุ ูุญุณุจ ุงุณุชููุงู ุงููููุ ูููุณููู ุงูุถุบุท ุนูู ุฒุฑ ุงูุชุฌุฏูุฏุ ูุน ุญูุธ ููุทุงุช ุจูุงูุงุช ูู ูุงุนุฏุฉ SQLite.
- ุงูุชูููุงุช: Node.js (CommonJS)ุ Telegraf (ุจูุช ุชูููุฌุฑุงู)ุ Playwright (ุฃุชูุชุฉ ุงููุชุตูุญ)ุ sqlite3 (ุชุฎุฒูู ูุญูู)ุ dotenv (ูุชุบูุฑุงุช ุจูุฆูุฉ)ุ node-cron (ูุชุงุญ ุฅู ุงุญุชุฌูุง ุฌุฏููุฉ).
- ุงูุชุดุบูู ุงูุณุฑูุน: ุงุถุจุท .env ุซู ุดุบูู ุงูุจูุช ุจุงูุฃูุฑ: node bot.js

## ูููู ุงููุดุฑูุน
- [bot.js](file:///c:/Users/Kepv/we-usage-bot/bot.js): ููุทู ุงูุจูุช ูุงูุฃูุงูุฑ ูุงูููุจูุฑุฏุ ุฑุจุท ุฌูุณุฉ ุงููุณุชุฎุฏู ูุญุณุงุจ ุงูุงุณุชููุงู ูุงูุชุฌุฏูุฏ.
- [weSession.js](file:///c:/Users/Kepv/we-usage-bot/weSession.js): ุชุณุฌูู ุงูุฏุฎูู ูุญูุธ ุญุงูุฉ ุงููุชุตูุญุ ูุชุญ ุตูุญุฉ ุงูุญุณุงุจุ ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุชุ ุงูุถุบุท ุนูู ุฒุฑ Renew.
- [usageDb.js](file:///c:/Users/Kepv/we-usage-bot/usageDb.js): ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช snapshots ูุฅุฏุฎุงู/ูุฑุงุกุฉ ุฃูู ููุทุฉ ููููุฉ.
- [package.json](file:///c:/Users/Kepv/we-usage-bot/package.json): ุงูุงุนุชูุงุฏุงุชุ ูุง ุชูุฌุฏ ุณูุฑุจุชุงุช ุชุดุบููุ ุงูุชุดุบูู ูุฏูู ุจู node bot.js.
- ูุฌูุฏ [sessions](file:///c:/Users/Kepv/we-usage-bot/sessions): ูููุงุช ุญุงูุฉ ุงูุชุฎุฒูู ูููุชุตูุญ (storage state) ูููุทุงุช ุดุงุดุฉ ููุชุตุญูุญ.
- ุณูุฑุจุชุงุช ูุณุงุนุฏุฉ: [debugLiveFull.js](file:///c:/Users/Kepv/we-usage-bot/debugLiveFull.js)ุ [extractWE.js](file:///c:/Users/Kepv/we-usage-bot/extractWE.js)ุ [testWE.js](file:///c:/Users/Kepv/we-usage-bot/testWE.js)ุ [testSession.js](file:///c:/Users/Kepv/we-usage-bot/testSession.js).

## ุชุฏูู ุงูุนูู
- ุฑุจุท ุงูุญุณุงุจ:
  - ุงูุฃูุฑ /link ูุจุฏุฃ ุญูุงุฑ ูุทูุจ ุฑูู ุงูุฎุฏูุฉ ุซู ูููุฉ ุงูุณุฑ.
  - ูุณุชุฏุนู loginAndSave ูุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ Playwright ูุญูุธ storageState ุจุงุณู state-<chatId>.json ูู sessions.
  - ุนูุฏ ูุฌุงุญ ุงูุฑุจุท: ุงูุจูุช ูุทูุจ /status.
- ุนุฑุถ ุงูุญุงูุฉ:
  - ุงูุฃูุฑ /status ูุดุบูู ูููุฉ ูุญุงููุงุช ุชููุงุฆูุฉ ุญุชู ููุฌุญ ุฌูุจ ุงูุจูุงูุงุช ุฃู ูุชู /stop.
  - ูุณุชุฏุนู fetchWithSession ููุชุญ ุตูุญุฉ Account Overview ุซู ุงุณุชุฎุฑุงุฌ: ุงูุฎุทุฉุ ุงููุชุจูู ูุงููุณุชุฎุฏู ุจุงูุฌูุฌุงุจุงูุชุ ุงูุฑุตูุฏุ ุชูุงุตูู ุงูุชุฌุฏูุฏุ ููุณุท ุงูุฑุงูุชุฑ ุฅู ูุฌุฏ.
  - ุชูุญูุธ ููุทุฉ ุงูุจูุงูุงุช ูู ุฌุฏูู snapshotsุ ูุชูุจูู ุฑุณุงูุฉ ูููุฎุตุฉ ูููุณุชุฎุฏู ุชุดูู ุญุตุชู ุงูููููุฉ ูุงููุชูุณุท.
- ุงุณุชููุงู ุงูููู:
  - ุงูุฃูุฑ /today ูุญุณุจ ุงููุฑู ุจูู ุฃูู ููุทุฉ ููููู ูุงููููุฉ ุงูุญุงููุฉ ูููุณุชุฎุฏู GBุ ููุนุฑุถู.
- ุงูุชุฌุฏูุฏ:
  - ุงูุฃูุฑ /renew ูุทูุจ ุชุฃููุฏ ุฎูุงู 60 ุซุงููุฉ ุฅุฐุง ููู ุงูุชุฌุฏูุฏ ูุตู ุฃู ูุชุฌุงูุฒ.
  - ุงูุฃูุฑ /renew_early ูุทูุจ ุชุฃููุฏ ุชุฌุฏูุฏ ูุจูุฑ ููุนุฑุถ ุงูุชูููุฉ ุงููุชููุนุฉ ูููุงุฑูุฉ ุงูุฑุตูุฏ.
  - ุนูุฏ CONFIRM ูุณุชุฏุนู renewWithSession ููุถุบุท ุนูู ุฒุฑ Renew ุฅู ูุงู ูุชุงุญูุง.
- ุชุณุฌูู ุงูุฎุฑูุฌ:
  - ุงูุฃูุฑ /logout ููุณุญ ููู ุงูุณูุดูุ ููููู ุฃู ููุงู ุญุงูุฉ ุฌุงุฑูุฉ.

## ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ููู ูุงุนุฏุฉ ุงูุจูุงูุงุช: usage.db
- ุฌุฏูู snapshots:
  - ุงูุญููู: chatId, day, capturedAt, usedGB, remainingGB, plan, balanceEGP, renewalDate, remainingDays, renewPriceEGP, routerMonthlyEGP, routerRenewalDate, totalRenewEGP
  - ููุฑุณ ูุฑููุจ: idx_snapshots_chat_day
- ุฅุฏุฑุงุฌ ููุทุฉ: insertSnapshot(chatId, snapshot)
- ุฃูู ููุทุฉ ููููู: getFirstOfDay(chatId, day) ูุงุณุชุฎุฏุงููุง ูู ุญุณุงุจ ุงุณุชููุงู ุงูููู.

## ูุงุฌูุฉ ุงูุจูุช
- ุฃูุงูุฑ: /start /menu /logout /link /stop /status /today /renew /renew_early
- ุฃุฒุฑุงุฑ ููุจูุฑุฏ: ๐ Statusุ ๐ Todayุ ๐ Renewุ โก Renew Earlyุ ๐ Link Accountุ ๐ช Logout
- ุญูุงูุฉ ุงููุตูู: ุงูุจูุช ููุงุฑู chat.id ูุน ALLOWED_CHAT_ID ููููุน ุบูุฑ ุงููุตุฑูุญ.

## ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ (.env)
- BOT_TOKEN: ุชููู ุชูููุฌุฑุงู ููุจูุช.
- ALLOWED_CHAT_ID: ุฑูู ุงูุดุงุช ุงููุณููุญ ูู ุจุงุณุชุฎุฏุงู ุงูุจูุช.
- BILLING_CYCLE_DAYS: ุนุฏุฏ ุฃูุงู ุฏูุฑุฉ ุงูุจุงูุฉ (ุงูุชุฑุงุถู 30) ูุญุณุงุจ ุงููุชูุณุท.
- DEBUG_WE: ูู ูููุชู 1 ููุนูู ููุทุงุช ุดุงุดุฉ ูุฑุณุงุฆู ุชุตุญูุญ ูู weSession.
- WE_SERVICE_NUMBER, WE_PASSWORD: ุชูุณุชุฎุฏู ูู ุณูุฑุจุชุงุช ุงูุฏูุจุงุฌ ููุท ุฅู ููุถุนุช.

## ููููุฉ ุงูุชุดุบูู
- ุซุจูุช ุงูุงุนุชูุงุฏุงุช: npm install
- ุฃูุดุฆ ููู .env ูุงููุฃ BOT_TOKEN ู ALLOWED_CHAT_ID
- ุดุบูู: node bot.js
- ุงุณุชุฎุฏู /link ูุฑุจุท ุงูุญุณุงุจ ุซู /status ุฃู ุงูุฃุฒุฑุงุฑ ุงููุฎุชุตุฑุฉ.

## ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ุนุจุฑ Playwright
- ูุชุญ ุตูุญุฉ ุงูุญุณุงุจ: openAccountOverviewWithSession ูุนูุฏ { browser, page } ุจุงุณุชุฎุฏุงู storageState ุงููุญููุธ.
- ุงูุชุธุงุฑ ุฌุงูุฒูุฉ ุงูุตูุญุฉ: waitForOverviewReady ูุจุญุซ ุนู ูุคุดุฑุงุช DOM ูุซู Usage Overview ูRemaining ููุฌุฑูุจ ุชูุฑูุฑ ุงูุตูุญุฉ ุฅู ูุฒู.
- ูุฑุงุกุฉ ุงูููู ุงูุฃุณุงุณูุฉ:
  - Remaining/Used: ูู ูุฑุจุนุงุช ุงููุต ุงููุญูุทุฉ ุจู span HasText
  - Current Balance: ูู ูุชูุฉ ุงููุต ุงููุฌุงูุฑุฉ
  - ุงูุฎุทุฉ: extractPlanRobust ูุจุญุซ ูู span[title] ูุน ุชูุฑูุฑ ุชุฏุฑูุฌู ููููุจุงู ุนุจุฑ ูุตู ุงูุตูุญุฉ.
- ุชูุงุตูู ุงูุชุฌุฏูุฏ ูุงูุฑุงูุชุฑ:
  - openMoreDetails ูุถุบุท More Details ูููุชุธุฑ ุนูุงุตุฑ ุงูุชุฌุฏูุฏ.
  - ุซูุงุซ ุทุฑู ุงุณุชุฎุฑุงุฌ A/B/C ุชูุฑุฃ Renewal Date ูRemaining Daysุ ูุชุชุญูู ูู ุฒุฑ Renewุ ูุชูุชูุท ุฃุณุนุงุฑ EGPุ ุซู pickRenewPriceFromEGPs ูุญุฏูุฏ ุณุนุฑ ุงูุจุงูุฉ ููุงุจู ุงูุฑุตูุฏ ููุณุท ุงูุฑุงูุชุฑ.
  - ุชูุญุณุจ totalRenewEGP = renewPriceEGP + routerMonthlyEGPุ ูcanAfford ุจููุงุฑูุฉ ุงูุฑุตูุฏ.

## ุงูุชุฌุฏูุฏ ุนุจุฑ ุงูุจูุช
- pendingRenew ูุฎุฒูู ูุถุน ุงูุชุฃููุฏ (normal ุฃู early) ูุน ุงูุชูุงุก ุตูุงุญูุฉ ุซุงููุชูู 60.
- ุนูุฏ CONFIRM: ููููุฐ renewWithSession ุงูุฐู ูุถุบุท ุนูู ุฒุฑ Renew ุฅู ูุงู ุบูุฑ ูุนุทููุ ุซู ูุบูู ุงููุชุตูุญ.

## ุฅุฏุงุฑุฉ ุงูุณูุดู
- statePath(chatId): ูุฎุฒูู storageState ูู sessions/state-<chatId>.json
- deleteSession(chatId): ูุญุฐู ููู ุงูุณูุดู ุนูุฏ /logout
- ุนูุฏ ุงูุชูุงุก ุงูุณูุดู: fetchWithSession ูุฑูู SESSION_EXPIRED ููุทูุจ /link ูููุณุชุฎุฏู.

## ุฃุฏูุงุช ุงูุฏูุจุงุฌ ูุงูุงุฎุชุจุงุฑ
- debugLiveFull.js: ุชุดุบูู ูุชุตูุญ ูุฑุฆู ุจุฎุทูุงุช ููุตูุฉ ูุงุณุชุฎุฑุงุฌ ุดุงููุ ููุจูู ููุชูุญูุง ูููุฑุงุฌุนุฉ ุงููุฏููุฉ.
- extractWE.js / testWE.js / testSession.js: ุฃูุซูุฉ ูุงุณุชุฎุฑุงุฌ/ุชุณุฌูู ุฏุฎูู ุณุฑูุนุ ูุง ุชูุณุชุฎุฏู ูู ุงูุชุดุบูู ุงูุฅูุชุงุฌู.
- ูุฌูุฏ sessions: ุตูุฑ ุชุตุญูุญ ููููุงุช ุญุงูุฉ.

## ููุงุญุธุงุช ุฃูููุฉ
- ุชุฌููุจ ูุถุน ุจูุงูุงุช ุฏุฎูู ุตุฑูุญุฉ ุฏุงุฎู ูููุงุช ุงูุณูุฑุจุช. ุงุณุชุฎุฏู .env ุนูุฏ ุงูุญุงุฌุฉ.
- ูุง ุชุดุงุฑู ูููุงุช sessions ุฃู usage.db ุฎุงุฑุฌ ุจูุฆุฉ ุงูุฌูุงุฒ.
- ูุตุฑ ุงุณุชุฎุฏุงู ุงูุจูุช ุนูู ALLOWED_CHAT_ID ูููุน ุงููุตูู ุบูุฑ ุงููุตุฑูุญ.

## ุฅุถุงูุฉ ุฃู ุชุนุฏูู ููุฒุฉ
- ุนุฑุถ ุจูุงูุงุช ุฌุฏูุฏุฉ ูู ุตูุญุฉ WE:
  - ุงุจุญุซ ุนู ุนูุตุฑ ุงููุต ูู ุงูุตูุญุฉ ุจุงุณุชุฎุฏุงู page.locator ุซู ุงุณุชุฎุฑุฌ ุงููููุฉ.
  - ุฃุถู ุงูุญูู ุฅูู ููุทุฉ snapshots ุฅู ุฃุฑุฏุช ุญูุธู ุชุงุฑูุฎููุงุ ูุชุฃูุฏ ูู ุชุฑููุฉ ุงูุฌุฏูู ุนุจุฑ safeAlter ุฅู ูุฒู.
  - ุญุฏูุซ ุฑุณุงูุฉ ุงูุนุฑุถ ูู bot.js ุถูู takeSnapshotAndFormat.
- ุชุญุณูู ุงูุงุนุชูุงุฏูุฉ:
  - ุฃุถู ูุคุดุฑุงุช ุฌุงูุฒูุฉ ุฌุฏูุฏุฉ ูู waitForOverviewReady ุนูุฏ ุชุบููุฑ ูุงุฌูุฉ WE.
  - ุญุณูู scoring ูู weSession ูุงูุชูุงุท ุฃูุถู ูุชูุฌุฉ ูู ุทุฑู A/B/C.
- ุฌุฏููุฉ ุชููุงุฆูุฉ:
  - node-cron ูุชุงุญ ูุฅุถุงูุฉ ููุงู ุฏูุฑูุฉ (ูุซู ููุทุฉ ุตุจุงุญูุฉ) ุฅู ุฑุบุจุช.

## ููุงุท ูููุฉ ุณุฑูุนุฉ
- ุงูููุงุณุงุช ูุงูุญุณุงุจุงุช:
  - todayUsed = currentUsedGB - ุฃูู ููุทุฉ ุงูููู
  - dailyShare = remainingGB / remainingDays
  - avgDaily = usedGB / (ุฃูุงู ูููุถูุฉ)
- ุฑุณุงุฆู ุงูุฃุฎุทุงุก ุงููุฃูููุฉ:
  - NO_SESSION: ูุง ุชูุฌุฏ ุฌูุณุฉ ูุญููุธุฉโุงุณุชุฎุฏู /link
  - SESSION_EXPIRED: ุงูุชูุช ุงูุฌูุณุฉโุฃุนุฏ /link
  - WE_FETCH_TIMEOUT / WE_LOGIN_TIMEOUT / WE_RENEW_TIMEOUT: ุงููููุน ุจุทูุก/ูุนูููโุฌุฑูุจ ูุงุญููุง

ูุฐุง ุงูููู ูู ุงููุฑุฌุน ุงููุฎุชุตุฑ ูุจู ุฃู ุชุนุฏูู ุฃู ุฅุถุงูุฉุ ููุบุทู ูุง ููุฒู ููุนุฑูุฉ ุฃูู ุชููููุฐ ุงูุชุบููุฑุงุช ูููููุฉ ุงุฎุชุจุงุฑูุง ุจุณุฑุนุฉ.
